// ==UserScript==
// @name              Pan Baidu direct link download assistant
// @namespace         https://github.com/syhyz1990/baiduyun
// @version           6.2.7
// @author            YouXiaoHou
// @description       👆👆👆👆👆👆👆 - 支持批量获取 ✅百度网盘 ✅阿里云盘 ✅天翼云盘 ✅迅雷云盘 ✅夸克网盘 ✅移动云盘 六大网盘的直链下载地址，配合 IDM，Xdown，Aria2，Curl，比特彗星等工具高效🚀🚀🚀下载，完美适配 Chrome，Edge，FireFox，360，QQ，搜狗，百分，遨游，星愿，Opera，猎豹，Vivaldi，Yandex，Kiwi 等 18 种浏览器。可在无法安装客户端的环境下使用，助手免费开源。😎
// @license           AGPL-3.0-or-later
// @homepage          https://www.youxiaohou.com/install.html
// @supportURL        https://github.com/syhyz1990/baiduyun
// @updateURL  https://raw.githubusercontent.com/FiorenMas/Shortlink/release/release/6.meta.js
// @downloadURL https://raw.githubusercontent.com/FiorenMas/Shortlink/release/release/6.user.js
// @match             *://pan.baidu.com/disk/home*
// @match             *://yun.baidu.com/disk/home*
// @match             *://pan.baidu.com/disk/main*
// @match             *://yun.baidu.com/disk/main*
// @match             *://pan.baidu.com/s/*
// @match             *://yun.baidu.com/s/*
// @match             *://pan.baidu.com/share/*
// @match             *://yun.baidu.com/share/*
// @match             *://openapi.baidu.com/*
// @match             *://www.aliyundrive.com/s/*
// @match             *://www.aliyundrive.com/drive*
// @match             *://www.alipan.com/s/*
// @match             *://www.alipan.com/drive*
// @match             *://cloud.189.cn/web/*
// @match             *://pan.xunlei.com/*
// @match             *://pan.quark.cn/*
// @match             *://yun.139.com/*
// @match             *://caiyun.139.com/*
// @require           https://unpkg.com/jquery@3.7.0/dist/jquery.min.js
// @require           https://unpkg.com/sweetalert2@10.16.6/dist/sweetalert2.all.min.js
// @require           https://unpkg.com/js-md5@0.7.3/build/md5.min.js
// @connect           baidu.com
// @connect           baidupcs.com
// @connect           aliyundrive.com
// @connect           alipan.com
// @connect           189.cn
// @connect           xunlei.com
// @connect           quark.cn
// @connect           youxiaohou.com
// @connect           yun.139.com
// @connect           caiyun.139.com
// @connect           localhost
// @run-at            document-idle
// @grant             unsafeWindow
// @grant             GM_xmlhttpRequest
// @grant             GM_setClipboard
// @grant             GM_setValue
// @grant             GM_getValue
// @grant             GM_deleteValue
// @grant             GM_openInTab
// @grant             GM_info
// @grant             GM_registerMenuCommand
// @grant             GM_cookie
// @grant             window.close
// @icon              data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMjggMTI4Ij48cGF0aCBkPSJNMTAzLjYgMTA3LjRjMy41LTIuMiA4LjktNi4xIDEzLjgtMTIuNXM3LjMtMTIuNSA4LjUtMTYuNWMuNS0xLjcgMi4yLTcuNSAyLjItMTQuNyAwLTEwLjEtMy4zLTI1LjEtMTUuNC0zNi44LTE0LjUtMTQtMzIuMS0xNC4zLTM1LjctMTQuMy04IDAtMTUuNyAxLjktMjIuNiA1LjJDNDQgMjMgMzUuNyAzMS40IDMwLjggNDEuN2MtMS4zIDIuOC00IDQuNy03LjEgNS00IC4zLTcuNSA0LjQtOC45IDkuNi0uNSAxLjktMS42IDMuNS0zLjEgNC43QzQuNCA2Ni44IDAgNzUuNyAwIDg1YzAgNi44IDIuMyAxMy4xIDYuMSAxOC4yIDUuNSA3LjQgMTQuMiAxMi4yIDI0IDEyLjJoNDcuMWM0LjQgMCAxMS0uNSAxOC4zLTMuNSAzLjItMS40IDUuOS0zIDguMS00LjV6IiBmaWxsPSIjNDQ0Ii8+PHBhdGggZD0iTTExOS44IDY0LjNjLjEtMTcuMS0xMC40LTI4LTEyLjUtMzAuMUM5NSAyMi4xIDc5LjkgMjEuOCA3Ni45IDIxLjhjLTE3LjYgMC0zMy4zIDEwLjUtMzkuOSAyNi43LS42IDEuMy0xLjggMi4zLTMuNCAyLjNoLS40Yy01LjggMC0xMC42IDQuOC0xMC42IDEwLjd2LjVjMCAxLjQtLjggMi42LTEuOSAzLjNDMTMuNCA2OSA4LjggNzYuOCA4LjggODVjMCAxMi4yIDkuOSAyMi4zIDIyLjIgMjIuM2g0NS4yYzMuNi0uMSAxNy42LS45IDI5LjYtMTIgMi45LTIuOCAxMy45LTEzLjcgMTQtMzF6IiBmaWxsPSIjMTM5N2Q4Ii8+PHBhdGggZD0iTTExMC44IDU3LjRsLjIgMy4zYzAgMS4zLTEuMSAyLjQtMi4zIDIuNC0xLjMgMC0yLjMtMS4xLTIuMy0yLjRsLS4xLTIuOHYtLjNjMC0xLjIuOS0yLjIgMi4xLTIuM2guM2MuNyAwIDEuMy4zIDEuNy43LS4yLjEuMy41LjQgMS40em0tMy4zLTEwLjNjMCAxLjItMSAyLjMtMi4yIDIuM2gtLjFjLS44IDAtMS42LS41LTItMS4yLTQuNi04LjMtMTMuMy0xMy41LTIyLjgtMTMuNS0xLjIgMC0yLjMtMS0yLjMtMi4ydi0uMWMwLTEuMiAxLTIuMyAyLjItMi4zaC4xYTMwLjM3IDMwLjM3IDAgMCAxIDE1LjggNC40YzQuNiAyLjggOC40IDYuOCAxMS4xIDExLjUuMS4zLjIuNy4yIDEuMXpNODguMyA3My44TDczLjUgOTMuMmMtMS41IDEuOS0zLjUgMy4xLTUuNyAzLjVoLS4yYy0uNC4xLS44LjEtMS4yLjEtLjYgMC0xLjEtLjEtMS42LS4yLTIuMi0uNC00LjItMS43LTUuNi0zLjVMNDQuMyA3My45Yy0yLTIuNi0yLjUtNS40LTEuNC03LjcuMS0uMS4xLS4yLjItLjIgMS4yLTIgMy41LTMuMiA2LjQtMy4yaDYuNnYtNS43YzAtNi44IDQuNy0xMiAxMC45LTEyIDQuOCAwIDguNSAyLjYgMTAuMyA3LjIuNSAxLjMtLjIgMi43LTEuNSAzLjJzLTIuOC0uMS0zLjMtMS40Yy0xLjEtMi43LTIuOS00LTUuNS00LTMuNSAwLTYgMy02IDd2OC4xYzAgLjUtLjIgMS0uNiAxLjQtLjYuNy0xLjcgMS4xLTIuNiAxLjFoLTguNGMtMS4zIDAtMiAuNC0yLjEuNy0uMi40IDAgMS4zLjkgMi40TDYzLjEgOTBjLjkgMS4yIDIuMSAxLjggMy4zIDEuOHMyLjMtLjYgMy4xLTEuN2wxNC44LTE5LjNjLjktMS4xIDEuMS0yIC45LTIuNC0uMi0uMy0uOS0uNy0yLjEtLjdoLTcuNmMtLjkgMC0xLjctLjUtMi4xLTEuMi0uMy0uNC0uNC0uOC0uNC0xLjMgMC0xLjQgMS4xLTIuNSAyLjUtMi41aDcuNmMzLjEgMCA1LjUgMS4zIDYuNiAzLjVsLjMuN2MuNyAyLjEuMSA0LjYtMS43IDYuOXoiIGZpbGw9IiM0NDQiLz48L3N2Zz4=
// ==/UserScript==
!function(){"use strict";let t="",n=[],i={},a="",l=800,o={},r="",s=$(document),d={},p={},c={},u={};const m=GM_info.script,g=m.version,h=m.author,f=(m.name,GM_info.scriptHandler),b=GM_info.version,k={popup:"pl-popup",header:"pl-header",title:"pl-title",closeButton:"pl-close",content:"pl-content",input:"pl-input",footer:"pl-footer"},v={wc:"Windows CMD",wp:"Windows PowerShell",lt:"Linux terminal",ls:"Linux Shell",mt:"MacOS terminal"};let w=Swal.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:3500,timerProgressBar:!1,didOpen:e=>{e.addEventListener("mouseenter",Swal.stopTimer),e.addEventListener("mouseleave",Swal.resumeTimer)}});const y=e=>{w.fire({title:e,icon:"success"})},x=e=>{w.fire({title:e,icon:"error"})};let _={getCookie(e){let t=e+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let i=n[e].trim();if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""},isType:e=>Object.prototype.toString.call(e).replace(/^\[object (.+)\]$/,"$1").toLowerCase(),getValue:e=>GM_getValue(e),setValue(e,t){GM_setValue(e,t)},deleteValue(e){GM_deleteValue(e)},getStorage(e){try{return JSON.parse(localStorage.getItem(e))}catch(t){return localStorage.getItem(e)}},setStorage(e,t){return"object"===this.isType(t)||"array"===this.isType(t)?localStorage.setItem(e,JSON.stringify(t)):localStorage.setItem(e,t)},setClipboard(e){GM_setClipboard(e,"text")},e:e=>btoa(unescape(encodeURIComponent(e))),d:e=>decodeURIComponent(escape(atob(e))),getExtension(e){const t=/(?!\.)\w+$/;if(t.test(e)){return e.match(t)[0].toUpperCase()}return""},sizeFormat(e){if(e===+e){let t=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(e)/Math.log(1024)),i=e/Math.pow(1024,n);return i=i.toFixed(1),i+t[n]}return""},sortByName(e){e.sort(((e,t)=>{const n=e.filename?e.filename:e.server_filename,i=t.filename?t.filename:t.server_filename;return n.localeCompare(i,"zh-CN")}))},fixFilename:e=>e.replace(/[!?&|`"'*\/:<>\\]/g,"_"),blobDownload(e,t){if(e instanceof Blob){const n=URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download=t,i.click(),URL.revokeObjectURL(n)}},post(e,t,n,i){return"object"===this.isType(t)&&(t=JSON.stringify(t)),new Promise(((a,l)=>{GM_xmlhttpRequest({method:"POST",url:e,headers:n,data:t,responseType:i||"json",onload:e=>{a("blob"===i?e:e.response||e.responseText)},onerror:e=>{l(e)}})}))},get:(e,t,n,i)=>new Promise(((a,l)=>{let o=GM_xmlhttpRequest({method:"GET",url:e,headers:t,responseType:n||"json",onload:e=>{204===e.status&&(o.abort(),u[i.index]=!0),"blob"===n?(200===e.status&&_.blobDownload(e.response,i.filename),a(e)):a(e.response||e.responseText)},onprogress:e=>{i&&i.filename&&i.index&&(e.total>0?d[i.index]=(100*e.loaded/e.total).toFixed(2):d[i.index]=0)},onloadstart(){i&&i.filename&&i.index&&(p[i.index]=o)},onerror:e=>{l(e)}})})),getFinalUrl:(e,t)=>new Promise(((n,i)=>{GM_xmlhttpRequest({method:"GET",url:e,headers:t,onload:e=>{n(e.finalUrl)},onerror:e=>{i(e)}})})),stringify(e){let t="";for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];if(Array.isArray(i))for(var a=0;a<i.length;a++)t+=encodeURIComponent(n)+"="+encodeURIComponent(i[a])+"&";else t+=encodeURIComponent(n)+"="+encodeURIComponent(i)+"&"}return t.slice(0,-1)},addStyle(e,t,n){t=t||"style";let i=document;if(i.getElementById(e))return;let a=i.createElement(t);a.rel="stylesheet",a.id=e,"style"===t?a.innerHTML=n:a.href=n,i.getElementsByTagName("head")[0].appendChild(a)},sleep:e=>new Promise((t=>setTimeout(t,e))),getMajorVersion(e){const[t]=(e||"").split(".");return/^\d+$/.test(t)?t:null},findReact(e,t=0){const n=e[Object.keys(e).find((e=>e.startsWith("__reactFiber$")||e.startsWith("__reactInternalInstance$")))];if(null==n)return null;if(n._currentElement){let e=n._currentElement._owner;for(let n=0;n<t;n++)e=e._currentElement._owner;return e._instance}const i=e=>{let t=e.return;for(;"string"==typeof t.type;)t=t.return;return t};let a=i(n);for(let e=0;e<t;e++)a=i(a);return a.stateNode||a},initDefaultConfig(){[{name:"setting_rpc_domain",value:"http://localhost"},{name:"setting_rpc_port",value:"16800"},{name:"setting_rpc_path",value:"/jsonrpc"},{name:"setting_rpc_token",value:""},{name:"setting_rpc_dir",value:"D:"},{name:"setting_terminal_type",value:"wc"},{name:"setting_theme_color",value:"#09AAFF"},{name:"setting_init_code",value:""},{name:"license",value:""}].forEach((e=>{void 0===_.getValue(e.name)&&_.setValue(e.name,e.value)}))},showSetting(){let e="",t="";e+=`<label class="pl-setting-label"><div class="pl-label">RPC Host</div><input type="text"  placeholder="Host address, begin with http(s)://" class="pl-input listener-domain" value="${_.getValue("setting_rpc_domain")}"></label>`,e+=`<label class="pl-setting-label"><div class="pl-label">RPC Port</div><input type="text" placeholder="Port number. Example: 16800 for Motrix" class="pl-input listener-port" value="${_.getValue("setting_rpc_port")}"></label>`,e+=`<label class="pl-setting-label"><div class="pl-label">RPC Path</div><input type="text" placeholder="Default is /jsonrpc}" class="pl-input listener-path" value="${_.getValue("setting_rpc_path")}"></label>`,e+=`<label class="pl-setting-label"><div class="pl-label">RPC Key</div><input type="text" placeholder="Leave it blank if not have key" class="pl-input listener-token" value="${_.getValue("setting_rpc_token")}"></label>`,e+=`<label class="pl-setting-label"><div class="pl-label">Save location</div><input type="text" placeholder="Path to save files after download. Example: D:" class="pl-input listener-dir" value="${_.getValue("setting_rpc_dir")}"></label>`,["#09AAFF","#cc3235","#526efa","#518c17","#ed944b","#f969a5","#bca280"].forEach((e=>{t+=`<div data-color="${e}" style="background: ${e};border: 1px solid ${e}" class="pl-color-box listener-color ${e===_.getValue("setting_theme_color")?"checked":""}"></div>`})),e+='<label class="pl-setting-label"><div class="pl-label">Terminal type</div><select class="pl-input listener-terminal">',Object.keys(v).forEach((t=>{e+=`<option value="${t}" ${_.getValue("setting_terminal_type")===t?"selected":""}>${v[t]}</option>`})),e+="</select></label>",e+=`<label class="pl-setting-label"><div class="pl-label">Theme color</div> <div class="pl-color">${t}<div></label>`,e="<div>"+e+"</div>",Swal.fire({title:"Configuration",html:e,icon:"info",showCloseButton:!0,showConfirmButton:!1,footer:o.footer}).then((()=>{y("Saved！"),history.go(0)})),s.on("click",".listener-color",(async e=>{_.setValue("setting_theme_color",e.target.dataset.color),y("Saved！"),history.go(0)})),s.on("input",".listener-domain",(async e=>{_.setValue("setting_rpc_domain",e.target.value)})),s.on("input",".listener-port",(async e=>{_.setValue("setting_rpc_port",e.target.value)})),s.on("input",".listener-path",(async e=>{_.setValue("setting_rpc_path",e.target.value)})),s.on("input",".listener-token",(async e=>{_.setValue("setting_rpc_token",e.target.value)})),s.on("input",".listener-dir",(async e=>{_.setValue("setting_rpc_dir",e.target.value)})),s.on("change",".listener-terminal",(async e=>{_.setValue("setting_terminal_type",e.target.value)}))},registerMenuCommand(){GM_registerMenuCommand("⚙️ Settings",(()=>{this.showSetting()}))},createTip(){$("body").append('<div class="pl-tooltip"></div>'),s.on("mouseenter mouseleave",".listener-tip",(e=>{if("mouseenter"===e.type){let t=`${e.currentTarget.innerText}<span style="margin-left: 10px;color: #f56c6c;">${e.currentTarget.dataset.size}</span>`;$(e.currentTarget).css({opacity:"0.5"}),$(".pl-tooltip").html(t).css({left:e.pageX+10+"px",top:e.pageY-e.currentTarget.offsetTop>14?e.pageY+"px":e.pageY+20+"px"}).show()}else $(e.currentTarget).css({opacity:"1"}),$(".pl-tooltip").hide(0)}))},createLoading:()=>$('<div class="pl-loading"><div class="pl-loading-box"><div><div></div><div></div></div></div></div>'),createDownloadIframe(){let e=$('<div style="padding:0;margin:0;display:block"></div>'),t=$('<iframe src="javascript:;" id="downloadIframe" style="display:none"></iframe>');e.append(t),$("body").append(e)},getMirrorList(e,t,n=2){let i=new URL(e).host,a=[];for(let l=0;l<t.length;l++)for(let o=0;o<n;o++){let n=e.replace(i,t[l])+"&".repeat(o);a.push(n)}return a.join("\n")},listenElement(e,t){let n=!1;!function i(){document.querySelector(e)?(n=!0,t()):n&&(n=!1),setTimeout(i,500)}()},addPanLinkerStyle(){r=_.getValue("setting_theme_color");let e=`\n            body::-webkit-scrollbar { display: none }\n            ::-webkit-scrollbar { width: 6px; height: 10px }\n            ::-webkit-scrollbar-track { border-radius: 0; background: none }\n            ::-webkit-scrollbar-thumb { background-color: rgba(85,85,85,.4) }\n            ::-webkit-scrollbar-thumb,::-webkit-scrollbar-thumb:hover { border-radius: 5px; -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.2) }\n            ::-webkit-scrollbar-thumb:hover { background-color: rgba(85,85,85,.3) }\n            .swal2-popup { font-size: 16px !important; }\n            .pl-popup { font-size: 12px !important; }\n            .pl-popup a { color: ${r} !important; }\n            .pl-header { padding: 0!important;align-items: flex-start!important; border-bottom: 1px solid #eee!important; margin: 0 0 10px!important; padding: 0 0 5px!important; }\n            .pl-title { font-size: 16px!important; line-height: 1!important;white-space: nowrap!important; text-overflow: ellipsis!important;}\n            .pl-content { padding: 0 !important; font-size: 12px!important; }\n            .pl-main { max-height: 400px;overflow-y:scroll; }\n            .pl-footer {font-size: 12px!important;justify-content: flex-start!important; margin: 10px 0 0!important; padding: 5px 0 0!important; color: #f56c6c!important; }\n            .pl-item { display: flex; align-items: center; line-height: 22px; }\n            .pl-item-name { flex: 0 0 150px; text-align: left;margin-right: 10px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; cursor:default; }\n            .pl-item-link { flex: 1; overflow: hidden; text-align: left; white-space: nowrap; text-overflow: ellipsis;cursor:pointer }\n            .pl-item-btn { background: ${r}; padding: 4px 5px; border-radius: 3px; line-height: 1; cursor: pointer; color: #fff; }\n            .pl-item-tip { display: flex; justify-content: space-between;flex: 1; }\n            .pl-back { width: 70px; background: #ddd; border-radius: 3px; cursor:pointer; margin:1px 0; }\n            .pl-ext { display: inline-block; width: 44px; background: #999; color: #fff; height: 16px; line-height: 16px; font-size: 12px; border-radius: 3px;}\n            .pl-retry {padding: 3px 10px; background: #cc3235; color: #fff; border-radius: 3px; cursor: pointer;}\n            .pl-browserdownload { padding: 3px 10px; background: ${r}; color: #fff; border-radius: 3px; cursor: pointer;}\n            .pl-item-progress { display:flex;flex: 1;align-items:center}\n            .pl-progress { display: inline-block;vertical-align: middle;width: 100%; box-sizing: border-box;line-height: 1;position: relative;height:15px; flex: 1}\n            .pl-progress-outer { height: 15px;border-radius: 100px;background-color: #ebeef5;overflow: hidden;position: relative;vertical-align: middle;}\n            .pl-progress-inner{ position: absolute;left: 0;top: 0;background-color: #409eff;text-align: right;border-radius: 100px;line-height: 1;white-space: nowrap;transition: width .6s ease;}\n            .pl-progress-inner-text { display: inline-block;vertical-align: middle;color: #d1d1d1;font-size: 12px;margin: 0 5px;height: 15px}\n            .pl-progress-tip{ flex:1;text-align:right}\n            .pl-progress-how{ flex: 0 0 90px; background: #ddd; border-radius: 3px; margin-left: 10px; cursor: pointer; text-align: center;}\n            .pl-progress-stop{ flex: 0 0 50px; padding: 0 10px; background: #cc3235; color: #fff; border-radius: 3px; cursor: pointer;margin-left:10px;height:20px}\n            .pl-progress-inner-text:after { display: inline-block;content: "";height: 100%;vertical-align: middle;}\n            .pl-btn-primary { background: ${r}; border: 0; border-radius: 4px; color: #ffffff; cursor: pointer; font-size: 12px; outline: none; display:flex; align-items: center; justify-content: center; margin: 2px 0; padding: 6px 0;transition: 0.3s opacity; }\n            .pl-btn-primary:hover { opacity: 0.9;transition: 0.3s opacity; }\n            .pl-btn-success { background: #55af28; animation: easeOpacity 1.2s 2; animation-fill-mode:forwards }\n            .pl-btn-info { background: #606266; }\n            .pl-btn-warning { background: #da9328; }\n            .pl-btn-warning { background: #da9328; }\n            .pl-btn-danger { background: #cc3235; }\n            .ali-button {display: inline-flex;align-items: center;justify-content: center;border: 0 solid transparent;border-radius: 5px;box-shadow: 0 0 0 0 transparent;width: fit-content;white-space: nowrap;flex-shrink: 0;font-size: 14px;line-height: 1.5;outline: 0;touch-action: manipulation;transition: background .3s ease,color .3s ease,border .3s ease,box-shadow .3s ease;color: #fff;background: rgb(99 125 255);margin-left: 20px;padding: 1px 12px;position: relative; cursor:pointer; height: 32px;}\n            .ali-button:hover {background: rgb(122, 144, 255)}\n            .tianyi-button {margin-right: 20px; padding: 4px 12px; border-radius: 4px; color: #fff; font-size: 12px; border: 1px solid #0073e3; background: #2b89ea; cursor: pointer; position: relative;}\n            .tianyi-button:hover {border-color: #1874d3; background: #3699ff;}\n            .yidong-button {float: left; position: relative; margin: 20px 24px 20px 0; width: 98px; height: 36px; background: #3181f9; border-radius: 2px; font-size: 14px; color: #fff; line-height: 39px; text-align: center; cursor: pointer;}\n            .yidong-share-button {display: inline-block; position: relative; font-size: 14px; line-height: 36px; height: 36px; text-align: center; color: #fff; border: 1px solid #5a9afa; border-radius: 2px; padding: 0 24px; margin-left: 24px; background: #3181f9; cursor: pointer;}\n            .yidong-button:hover {background: #2d76e5;}\n            .xunlei-button {display: inline-flex;align-items: center;justify-content: center;border: 0 solid transparent;border-radius: 5px;box-shadow: 0 0 0 0 transparent;width: fit-content;white-space: nowrap;flex-shrink: 0;font-size: 14px;line-height: 1.5;outline: 0;touch-action: manipulation;transition: background .3s ease,color .3s ease,border .3s ease,box-shadow .3s ease;color: #fff;background: #3f85ff;margin-left: 12px;padding: 0px 12px;position: relative; cursor:pointer; height: 36px;}\n            .xunlei-button:hover {background: #619bff}\n            .quark-button {display: inline-flex; align-items: center; justify-content: center; border: 1px solid #ddd; border-radius: 8px; white-space: nowrap; flex-shrink: 0; font-size: 14px; line-height: 1.5; outline: 0; color: #333; background: #fff; margin-right: 10px; padding: 0px 14px; position: relative; cursor: pointer; height: 36px;}\n            .quark-button:hover { background:#f6f6f6 }\n            .pl-dropdown-menu {position: absolute;right: 0;top: 30px;padding: 5px 0;color: rgb(37, 38, 43);background: #fff;z-index: 999;width: 102px;border: 1px solid #ddd;border-radius: 10px; box-shadow: 0 0 1px 1px rgb(28 28 32 / 5%), 0 8px 24px rgb(28 28 32 / 12%);}\n            .pl-dropdown-menu-item { height: 30px;display: flex;align-items: center;justify-content: center;cursor:pointer }\n            .pl-dropdown-menu-item:hover { background-color: rgba(132,133,141,0.08);}\n            .pl-button .pl-dropdown-menu { display: none; }\n            .pl-button:hover .pl-dropdown-menu { display: block!important; }\n            .pl-button-init { opacity: 0.5; animation: easeInitOpacity 1.2s 3; animation-fill-mode:forwards }\n             @keyframes easeInitOpacity { from { opacity: 0.5; } 50% { opacity: 1 } to { opacity: 0.5; } }\n             @keyframes easeOpacity { from { opacity: 1; } 50% { opacity: 0.35 } to { opacity: 1; } }\n            .element-clicked { opacity: 0.5; }\n            .pl-extra { margin-top: 10px;display:flex}\n            .pl-extra button { flex: 1}\n            .pointer { cursor:pointer }\n            .pl-setting-label { display: flex;align-items: center;justify-content: space-between;padding-top: 10px; }\n            .pl-label { flex: 0 0 100px;text-align:left; }\n            .pl-input { flex: 1; padding: 8px 10px; border: 1px solid #c2c2c2; border-radius: 5px; font-size: 14px }\n            .pl-color { flex: 1;display: flex;flex-wrap: wrap; margin-right: -10px;}\n            .pl-color-box { width: 35px;height: 35px;margin:10px 10px 0 0;; box-sizing: border-box;border:1px solid #fff;cursor:pointer }\n            .pl-color-box.checked { border:3px dashed #111!important }\n            .pl-close:focus { outline: 0; box-shadow: none; }\n            .tag-danger {color:#cc3235;margin: 0 5px;}\n            .pl-tooltip { position: absolute; color: #ffffff; max-width: 600px; font-size: 12px; padding: 5px 10px; background: #333; border-radius: 5px; z-index: 110000; line-height: 1.3; display:none; word-break: break-all;}\n             @keyframes load { 0% { transform: rotate(0deg) } 100% { transform: rotate(360deg) } }\n            .pl-loading-box > div > div { position: absolute;border-radius: 50%;}\n            .pl-loading-box > div > div:nth-child(1) { top: 9px;left: 9px;width: 82px;height: 82px;background: #ffffff;}\n            .pl-loading-box > div > div:nth-child(2) { top: 14px;left: 38px;width: 25px;height: 25px;background: #666666;animation: load 1s linear infinite;transform-origin: 12px 36px;}\n            .pl-loading { width: 16px;height: 16px;display: inline-block;overflow: hidden;background: none;}\n            .pl-loading-box { width: 100%;height: 100%;position: relative;transform: translateZ(0) scale(0.16);backface-visibility: hidden;transform-origin: 0 0;}\n            .pl-loading-box div { box-sizing: content-box; }\n            .swal2-container { z-index:100000!important; }\n            body.swal2-height-auto { height: inherit!important; }\n            .btn-operate .btn-main { display:flex; align-items:center; }\n            `;this.addStyle("panlinker-style","style",e)},async initDialog(){let e=await Swal.fire({title:"Accept license agreement",html:"<div></div>",allowOutsideClick:!1,showCloseButton:!0,confirmButtonText:"Accept"});e.isDismissed&&"close"===e.dismiss||(_.setValue("setting_init_code",o.num),_.setValue("license",o.license),y(o.init[2]),setTimeout((()=>{history.go(0)}),1500))}},C={_getExtra:()=>'{"sekey":"'+decodeURIComponent(_.getCookie("BDCLND"))+'"}',_getSurl(){let e=/(?<=s\/|surl=)([a-zA-Z0-9_-]+)/g;return e.test(location.href)?location.href.match(e)[0]:""},_getFidList(){let e=[];return n.forEach((t=>{1!=+t.isdir&&e.push(t.fs_id)})),"["+e+"]"},_resetData(){d={},$.each(p,(e=>{p[e].abort()})),$.each(c,(e=>{clearInterval(c[e])})),u={},c={},p={}},setBDUSS(){try{GM_cookie&&GM_cookie("list",{name:"BDUSS"},((e,t)=>{if(!t){let t=e?.[0]?.value;t&&_.setStorage("baiduyunPlugin_BDUSS",{BDUSS:t})}}))}catch(e){}},getBDUSS:()=>(_.getStorage("baiduyunPlugin_BDUSS")?_.getStorage("baiduyunPlugin_BDUSS"):'{"baiduyunPlugin_BDUSS":""}').BDUSS||"",convertLinkToAria(e,t,n){let i=this.getBDUSS();return i?(t=_.fixFilename(t),encodeURIComponent(`aria2c "${e}" --out "${t}" --header "User-Agent: ${n}" --header "Cookie: BDUSS=${i}"`)):{link:o.assistant,text:o.init[5]}},convertLinkToBC(e,t,n){let i=this.getBDUSS();if(i){let a=`BDUSS=${i}`,l=`AA/${encodeURIComponent(t)}/?url=${encodeURIComponent(e)}&cookie=${encodeURIComponent(a)}&user_agent=${encodeURIComponent(n)}ZZ`;return encodeURIComponent(`bc://http/${_.e(l)}`)}return{link:o.assistant,text:o.init[5]}},convertLinkToCurl(e,t,n){let i=this.getBDUSS();if(i){let a=_.getValue("setting_terminal_type");return t=_.fixFilename(t),encodeURIComponent(`${"wp"!==a?"curl":"curl.exe"} -L -C - "${e}" -o "${t}" -A "${n}" -b "BDUSS=${i}"`)}return{link:o.assistant,text:o.init[5]}},addPageListener(){function e(e){let t=$(e.target),n=t.parents(".pl-item"),i=n.find(".pl-item-link"),a=n.find(".pl-item-progress"),l=n.find(".pl-item-tip");return{item:n,link:i,progress:a,tip:l,target:t}}s.on("mouseenter mouseleave click",".pl-button.g-dropdown-button",(e=>{"mouseleave"===e.type?$(e.currentTarget).removeClass("button-open"):($(e.currentTarget).addClass("button-open"),$(e.currentTarget).find(".pl-dropdown-menu").show())})),s.on("mouseleave",".pl-button.g-dropdown-button .pl-dropdown-menu",(e=>{$(e.currentTarget).hide()})),s.on("click",".pl-button-mode",(e=>{a=e.target.dataset.mode,Swal.showLoading(),this.getPCSLink()})),s.on("click",".listener-link-api",(async t=>{t.preventDefault();let n=e(t),i=n.item.find(".pl-progress-inner"),a=n.item.find(".pl-progress-inner-text"),l=n.link[0].dataset.filename,r=n.link[0].dataset.index;var s;c[s=r]&&clearInterval(c[s]),p[s]&&p[s].abort(),d[s]=0,u[s]=!1,_.get(n.link[0].dataset.link,{"User-Agent":o.ua},"blob",{filename:l,index:r}),c[r]=setInterval((()=>{let e=+d[r]||0;u[r]||!1?(n.tip.hide(),n.progress.hide(),n.link.text("已成功唤起IDM，请查看IDM下载框！").animate({opacity:"0.5"},"slow").show(),clearInterval(c[r]),u[r]=!1):(n.link.hide(),n.tip.hide(),n.progress.show(),i.css("width",e+"%"),a.text(e+"%"),100===e&&(clearInterval(c[r]),d[r]=0,n.item.find(".pl-progress-stop").hide(),n.item.find(".pl-progress-tip").html("Download completed and browser will popup download box！")))}),500)})),s.on("click",".listener-retry",(async t=>{let n=e(t);n.tip.hide(),n.link.show()})),s.on("click",".listener-how",(async t=>{let n=e(t),i=n.link[0].dataset.index;p[i]&&(p[i].abort(),clearInterval(c[i]),n.progress.hide(),n.tip.show())})),s.on("click",".listener-stop",(async t=>{let n=e(t),i=n.link[0].dataset.index;p[i]&&(p[i].abort(),clearInterval(c[i]),n.tip.hide(),n.progress.hide(),n.link.show(0))})),s.on("click",".listener-back",(async t=>{let n=e(t);n.tip.hide(),n.link.show()})),s.on("click",".listener-link-aria, .listener-copy-all",(e=>{e.preventDefault(),e.target.dataset.link?(_.setClipboard(decodeURIComponent(e.target.dataset.link)),$(e.target).text("Copied successfully!").animate({opacity:"0.5"},"slow")):$(e.target).removeClass("listener-copy-all").addClass("pl-btn-danger").html(`${o.init[5]}👉<a href="${o.assistant}" target="_blank" class="pl-a">点击此处安装</a>👈`)})),s.on("click",".listener-link-rpc",(async e=>{let t=$(e.currentTarget);t.find(".icon").remove(),t.find(".pl-loading").remove(),t.prepend(_.createLoading());let n=await this.sendLinkToRPC(e.currentTarget.dataset.filename,e.currentTarget.dataset.link);"success"===n?($(".listener-rpc-task").show(),t.removeClass("pl-btn-danger").html("发送成功，快去看看吧！").animate({opacity:"0.5"},"slow")):"assistant"===n?t.addClass("pl-btn-danger").html(`${o.init[5]}👉<a href="${o.assistant}" target="_blank" class="pl-a">点击此处安装</a>👈`):t.addClass("pl-btn-danger").text("发送失败，请检查您的RPC配置信息！").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-send-rpc",(e=>{$(".listener-link-rpc").click(),$(e.target).text("发送完成，发送结果见上方按钮！").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-open-setting",(()=>{_.showSetting()})),s.on("click",".listener-rpc-task",(()=>{let e=JSON.stringify({domain:_.getValue("setting_rpc_domain"),port:_.getValue("setting_rpc_port")}),t=`${o.d}/?rpc=${_.e(e)}#${_.getValue("setting_rpc_token")}`;GM_openInTab(t,{active:!0})})),document.documentElement.addEventListener("mouseup",(e=>{"A"===e.target.nodeName&&~e.target.className.indexOf("pl-a")&&e.stopPropagation()}),!0)},addButton(){if(!t)return;let e,n=$(`<div class="g-dropdown-button pointer pl-button"><div style="color:#fff;background: ${r};border-color:${r}" class="g-button g-button-blue"><span class="g-button-right"><em class="icon icon-download"></em><span class="text" style="width: 60px;">Download</span></span></div><div class="menu" style="width:auto;z-index:41;border-color:${r}"><div style="color:${r}" class="g-button-menu pl-button-mode" data-mode="api">API Download</div><div style="color:${r}" class="g-button-menu pl-button-mode" data-mode="aria">Aria Download</div><div style="color:${r}" class="g-button-menu pl-button-mode" data-mode="rpc">RPC Download</div><div style="color:${r}" class="g-button-menu pl-button-mode" data-mode="curl">cURL Download</div><div style="color:${r}" class="g-button-menu pl-button-mode" data-mode="bc">BC Download</div><li class="g-button-menu pl-button-mode listener-open-setting">助手设置</li>${200==o.code&&g<o.version?o.new:""}</div></div>`);"home"===t&&(e=$(o.btn.home)),"main"===t&&(e=$(o.btn.main),n=$(`<div class="pl-button" style="position: relative; display: inline-block; margin-right: 8px;"><button class="u-button u-button--primary u-button--small is-round is-has-icon" style="background: ${r};border-color: ${r};font-size: 14px; padding: 8px 16px; border: none;"><i class="u-icon u-icon-download"></i><span>Download</span></button><ul class="dropdown-list nd-common-float-menu pl-dropdown-menu"><li class="sub cursor-p pl-button-mode" data-mode="api">API Download</li><li class="sub cursor-p pl-button-mode" data-mode="aria">Aria Download</li><li class="sub cursor-p pl-button-mode" data-mode="rpc">RPC Download</li><li class="sub cursor-p pl-button-mode" data-mode="curl">cURL Download</li><li class="sub cursor-p pl-button-mode" data-mode="bc" >BC Download</li><li class="sub cursor-p pl-button-mode listener-open-setting">助手设置</li>${200==o.code&&g<o.version?o.newX:""}</ul></div>`)),"share"===t&&(e=$(o.btn.share)),e.prepend(n),this.setBDUSS(),this.addPageListener()},addInitButton(){if(!t)return;let e,n=$(`<div class="g-dropdown-button pointer pl-button-init" style="opacity:.5"><div style="color:#fff;background: ${r};border-color:${r}" class="g-button g-button-blue"><span class="g-button-right"><em class="icon icon-download"></em><span class="text" style="width: 60px;">Download</span></span></div></div>`);"home"===t&&(e=$(o.btn.home)),"main"===t&&(e=$(o.btn.main),n=$(`<div class="pl-button-init" style="opacity:.5; display: inline-block; margin-right: 8px;"><button class="u-button u-button--primary u-button--small is-round is-has-icon" style="background: ${r};border-color: ${r};font-size: 14px; padding: 8px 16px; border: none;"><i class="u-icon u-icon-download"></i><span>Download</span></button></div>`)),"share"===t&&(e=$(o.btn.share)),e.prepend(n),n.click((()=>_.initDialog()))},async getToken(){const e=()=>{GM_openInTab(o.pcs[3],{active:!1,insert:!0,setParent:!0}),_.deleteValue("baidu_access_token")},t=()=>new Promise((e=>{let t=0;const n=setInterval((()=>{const i=_.getValue("baidu_access_token");i&&(clearInterval(n),e(i)),t++,t>60&&(clearInterval(n),e(""))}),1e3)}));if("Tampermonkey"===f&&_.getMajorVersion(b)>=5)return e(),t();let n=await _.getFinalUrl(o.pcs[3]);if(!n.includes("authorize")&&!n.includes("access_token="))return e(),t();if(n.includes("authorize")){let e=await _.get(o.pcs[3],{},"text"),t=e.match(/name="bdstoken"\s+value="([^"]+)"/)?.[1],n=e.match(/name="client_id"\s+value="([^"]+)"/)?.[1],i={grant_permissions_arr:"netdisk",bdstoken:t,client_id:n,response_type:"token",display:"page",grant_permissions:"basic,netdisk"};await _.post(o.pcs[3],_.stringify(i),{"Content-Type":"application/x-www-form-urlencoded"});let a=await _.getFinalUrl(o.pcs[3]),l=a.match(/access_token=([^&]+)/)?.[1];return l&&_.setValue("baidu_access_token",l),l}let i=n.match(/access_token=([^&]+)/)?.[1];return i&&_.setValue("baidu_access_token",i),i},async getPCSLink(e=1){n=this.getSelectedList();let l,r,s=this._getFidList();if("home"===t||"main"===t){if(0===n.length)return x("Please choose files you want to download first！");if(2===s.length)return x("Please open folder and then select files！");s=encodeURIComponent(s);let e=_.getValue("baidu_access_token")||await this.getToken();l=`${o.pcs[0]}&fsids=${s}&access_token=${e}`,r=await _.get(l,{"User-Agent":o.ua})}if("share"!==t)if(0===r.errno){let e=this.generateDom(r.list);this.showMainDialog(o[a][0],e,o[a][1])}else{if(112===r.errno)return x("提示：页面过期，请刷新重试！");9019===r.errno?(e--,await this.getToken(),e>0?await this.getPCSLink(e):x("提示：获取下载链接失败！请刷新网页后重试！")):(_.deleteValue("baidu_access_token"),x("提示：获取下载链接失败！请刷新网页后重试！"))}else{if(this.getShareData(),!i.bdstoken)return x("Please login first！");if(0===n.length)return x("Please choose files you want to download first！");if(2===s.length)return x("Please open folder and then select files！");(await Swal.fire({toast:!0,icon:"info",title:'提示：请将文件<span class="tag-danger">[保存到网盘]</span>👉前往<span class="tag-danger">[我的网盘]</span>中下载！',showConfirmButton:!0,confirmButtonText:"点击保存",position:"top"})).isConfirmed&&$(".tools-share-save-hb")[0].click()}},generateDom(e){let t='<div class="pl-main">',n="";if(_.sortByName(e),e.forEach(((e,i)=>{if(1===e.isdir)return;let l=e.server_filename||e.filename,r=_.getExtension(l),s=_.sizeFormat(e.size),d=e.dlink+"&access_token="+_.getValue("baidu_access_token");if("api"===a&&(t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${s}">${l}</div>\n                                <a class="pl-item-link pl-a listener-link-api" href="${d}" data-filename="${l}" data-link="${d}" data-index="${i}">${d}</a>\n                                <div class="pl-item-tip" style="display: none"><span>若没有弹出IDM下载框，找到IDM <b>选项</b> -> <b>文件类型</b> -> <b>第一个框</b> 中添加后缀 <span class="pl-ext">${r}</span>，<a href="${o.idm}" target="_blank" class="pl-a">详见此处</a></span> <span class="pl-back listener-back">返回</span></div>\n                                <div class="pl-item-progress" style="display: none">\n                                    <div class="pl-progress">\n                                        <div class="pl-progress-outer"></div>\n                                        <div class="pl-progress-inner" style="width:5%">\n                                          <div class="pl-progress-inner-text">0%</div>\n                                        </div>\n                                    </div>\n                                    <span class="pl-progress-stop listener-stop">Cancel download</span>\n                                    <span class="pl-progress-tip">Not found IDM, use built-in browser download</span>\n                                    <span class="pl-progress-how listener-how">How to use IDM?</span>\n                                </div></div>`),"aria"===a){let e=this.convertLinkToAria(d,l,o.ua);"object"==typeof e?t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${s}">${l}</div>\n                                <a class="pl-item-link pl-a" target="_blank" href="${e.link}" data-filename="${l}" data-link="${e.link}">${decodeURIComponent(e.text)}</a> </div>`:(n+=e+"\r\n",t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${s}">${l}</div>\n                                <a class="pl-item-link pl-a listener-link-aria" href="${e}" title="点击复制aria2c链接" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`)}if("rpc"===a&&(t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${s}">${l}</div>\n                                <button class="pl-item-link listener-link-rpc pl-btn-primary pl-btn-info" data-filename="${l}" data-link="${d}"><em class="icon icon-device"></em><span style="margin-left: 5px;">推送到 RPC 下载器</span></button></div>`),"curl"===a){let e=this.convertLinkToCurl(d,l,o.ua);"object"==typeof e?t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${s}">${l}</div>\n                                <a class="pl-item-link pl-a" target="_blank" href="${e.link}" data-filename="${l}" data-link="${e.link}">${decodeURIComponent(e.text)}</a> </div>`:(n+=e+"\r\n",t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${s}">${l}</div>\n                                <a class="pl-item-link pl-a listener-link-aria" href="${e}" title="点击复制curl链接" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`)}if("bc"===a){let e=this.convertLinkToBC(d,l,o.ua);t+="object"==typeof e?`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${s}">${l}</div>\n                                <a class="pl-item-link pl-a" target="_blank" href="${e.link}" data-filename="${l}" data-link="${e.link}">${decodeURIComponent(e.text)}</a> </div>`:`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${s}">${l}</div>\n                                <a class="pl-item-link pl-a" href="${decodeURIComponent(e)}" title="点击用比特彗星下载" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`}})),t+="</div>","aria"===a&&(t+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${n}">Copy all links</button></div>`),"rpc"===a){let e=_.getValue("setting_rpc_domain")+":"+_.getValue("setting_rpc_port")+_.getValue("setting_rpc_path");t+=`<div class="pl-extra"><button class="pl-btn-primary listener-send-rpc">发送全部链接</button><button title="${e}" class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px">设置 RPC 参数（当前为：${e}）</button><button class="pl-btn-primary pl-btn-success listener-rpc-task" style="margin-left: 10px;display: none">查看下载任务</button></div>`}return"curl"===a&&(t+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${n}">Copy all links</button><button class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px;">Terminal type (Currently:${v[_.getValue("setting_terminal_type")]}）</button></div>`),t},async sendLinkToRPC(e,t){let n={domain:_.getValue("setting_rpc_domain"),port:_.getValue("setting_rpc_port"),path:_.getValue("setting_rpc_path"),token:_.getValue("setting_rpc_token"),dir:_.getValue("setting_rpc_dir")},i=this.getBDUSS();if(!i)return"assistant";let a=`${n.domain}:${n.port}${n.path}`,l={id:(new Date).getTime(),jsonrpc:"2.0",method:"aria2.addUri",params:[`token:${n.token}`,[t],{dir:n.dir,out:e,header:[`User-Agent: ${o.ua}`,`Cookie: BDUSS=${i}`]}]};try{return(await _.post(a,l,{"User-Agent":o.ua},"")).result?"success":"fail"}catch(e){return"fail"}},getSelectedList(){try{return require("system-core:context/context.js").instanceForSystem.list.getSelected()}catch(e){return document.querySelector(".wp-s-core-pan").__vue__.selectedList}},getLogid:()=>require("system-core:context/context.js").instanceForSystem.tools.baseService.base64Encode(_.getCookie("BAIDUID")),getShareData(){let e=locals.dump();i.shareType="secret",i.sign="",i.timestamp="",i.bdstoken=e.bdstoken.value,i.channel="chunlei",i.clienttype=0,i.web=1,i.app_id=250528,i.encrypt=0,i.product="share",i.logid=this.getLogid(),i.primaryid=e.shareid.value,i.uk=e.share_uk.value,"secret"===i.shareType&&(i.extra=this._getExtra()),i.surl=this._getSurl()},detectPage(){let e=location.pathname;return/^\/disk\/home/.test(e)?"home":/^\/disk\/main/.test(e)?"main":/^\/(s|share)\//.test(e)?"share":""},showMainDialog(e,t,n){Swal.fire({html:t,allowOutsideClick:!1,showCloseButton:!0,showConfirmButton:!1,position:"top",width:l,padding:"15px 20px 5px",customClass:k}).then((()=>{this._resetData()}))},async initPanLinker(){_.initDefaultConfig(),_.addPanLinkerStyle(),t=this.detectPage();let e=await _.post(`https://api.youxiaohou.com/config/v2?ver=${g}&a=${h}`,{},{},"text");o=JSON.parse(_.d(e)),Object.freeze&&Object.freeze(o),o.num===_.getValue("setting_init_code")||o.license===_.getValue("license")?this.addButton():this.addInitButton(),_.createTip(),_.registerMenuCommand()},async initAuthorize(){setInterval((()=>{if(/openapi.baidu.com\/oauth\/2.0\/authorize/.test(location.href)){let e=document.querySelector("#auth-allow");if(e)return void e.click()}if(/openapi.baidu.com\/oauth\/2.0\/login_success/.test(location.href)&&location.href.includes("access_token")){let e=location.href.match(/access_token=(.*?)&/)[1];_.setValue("baidu_access_token",e),window.close()}}),200)}},S={convertLinkToAria:(e,t,n)=>(t=_.fixFilename(t),encodeURIComponent(`aria2c "${e}" --out "${t}" --header "Referer: https://www.aliyundrive.com/"`)),convertLinkToBC(e,t,n){let i=`AA/${encodeURIComponent(t)}/?url=${encodeURIComponent(e)}&refer=${encodeURIComponent("https://www.aliyundrive.com/")}ZZ`;return encodeURIComponent(`bc://http/${_.e(i)}`)},convertLinkToCurl(e,t,n){let i=_.getValue("setting_terminal_type");return t=_.fixFilename(t),encodeURIComponent(`${"wp"!==i?"curl":"curl.exe"} -L -C - "${e}" -o "${t}" -e "https://www.aliyundrive.com/"`)},addPageListener(){s.on("click",".pl-button-mode",(e=>{a=e.target.dataset.mode,Swal.showLoading(),this.getPCSLink()})),s.on("click",".listener-link-api",(async e=>{e.preventDefault();let t=e.currentTarget.dataset.link;$("#downloadIframe").attr("src",t)})),s.on("click",".listener-link-api-btn",(async e=>{_.setClipboard(e.target.dataset.filename),$(e.target).text("复制成功").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-link-aria, .listener-copy-all",(e=>{e.preventDefault(),_.setClipboard(decodeURIComponent(e.target.dataset.link)),$(e.target).text("Copied successfully!").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-link-rpc",(async e=>{let t=$(e.currentTarget);t.find(".icon").remove(),t.find(".pl-loading").remove(),t.prepend(_.createLoading()),"success"===await this.sendLinkToRPC(e.currentTarget.dataset.filename,e.currentTarget.dataset.link)?($(".listener-rpc-task").show(),t.removeClass("pl-btn-danger").html("发送成功，快去看看吧！").animate({opacity:"0.5"},"slow")):t.addClass("pl-btn-danger").text("发送失败，请检查您的RPC配置信息！").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-send-rpc",(e=>{$(".listener-link-rpc").click(),$(e.target).text("发送完成，发送结果见上方按钮！").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-open-setting",(()=>{_.showSetting()})),s.on("click",".listener-rpc-task",(()=>{let e=JSON.stringify({domain:_.getValue("setting_rpc_domain"),port:_.getValue("setting_rpc_port")}),t=`${o.d}/?rpc=${_.e(e)}#${_.getValue("setting_rpc_token")}`;GM_openInTab(t,{active:!0})}))},async getRealLink(e,t){let n=`${_.getStorage("token").token_type} ${_.getStorage("token").access_token}`,i=await _.post(o.pcs[1],{drive_id:e,file_id:t},{authorization:n,"content-type":"application/json;charset=utf-8",referer:"https://www.aliyundrive.com/","x-canary":"client=windows,app=adrive,version=v6.0.0"});return"AccessTokenInvalid"===i.code?x("提示：Token过期，请刷新网页后重试！"):i.url?i.url:""},addButton(){if(!t)return;let e,n=$(`<div class="ali-button pl-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M853.333 938.667H170.667a85.333 85.333 0 0 1-85.334-85.334v-384A85.333 85.333 0 0 1 170.667 384H288a32 32 0 0 1 0 64H170.667a21.333 21.333 0 0 0-21.334 21.333v384a21.333 21.333 0 0 0 21.334 21.334h682.666a21.333 21.333 0 0 0 21.334-21.334v-384A21.333 21.333 0 0 0 853.333 448H736a32 32 0 0 1 0-64h117.333a85.333 85.333 0 0 1 85.334 85.333v384a85.333 85.333 0 0 1-85.334 85.334z" fill="#fff"/><path d="M715.03 543.552a32.81 32.81 0 0 0-46.251 0L554.005 657.813v-540.48a32 32 0 0 0-64 0v539.734L375.893 543.488a32.79 32.79 0 0 0-46.229 0 32.427 32.427 0 0 0 0 46.037l169.557 168.811a32.81 32.81 0 0 0 46.251 0l169.557-168.81a32.47 32.47 0 0 0 0-45.974z" fill="#FF9C00"/></svg><span>Download</span><ul class="pl-dropdown-menu"><li class="pl-dropdown-menu-item pl-button-mode" data-mode="api">API Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="aria" >Aria Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="rpc">RPC Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="curl">cURL Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="bc" >BC Download</li><li class="pl-dropdown-menu-item pl-button-mode listener-open-setting">助手设置</li>${200==o.code&&g<o.version?o.new:""}</ul></div>`);"home"===t&&_.listenElement(o.btn.home,(()=>{e=$(o.btn.home),0===$(".pl-button").length&&e.append(n)})),"share"===t&&(n.css({"margin-right":"10px"}),_.listenElement(o.btn.share,(()=>{e=$(o.btn.share),0===$(".pl-button").length&&e.prepend(n)}))),_.createDownloadIframe(),this.addPageListener()},addInitButton(){if(!t)return;let e,n=$('<div class="ali-button pl-button-init"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M853.333 938.667H170.667a85.333 85.333 0 0 1-85.334-85.334v-384A85.333 85.333 0 0 1 170.667 384H288a32 32 0 0 1 0 64H170.667a21.333 21.333 0 0 0-21.334 21.333v384a21.333 21.333 0 0 0 21.334 21.334h682.666a21.333 21.333 0 0 0 21.334-21.334v-384A21.333 21.333 0 0 0 853.333 448H736a32 32 0 0 1 0-64h117.333a85.333 85.333 0 0 1 85.334 85.333v384a85.333 85.333 0 0 1-85.334 85.334z" fill="#fff"/><path d="M715.03 543.552a32.81 32.81 0 0 0-46.251 0L554.005 657.813v-540.48a32 32 0 0 0-64 0v539.734L375.893 543.488a32.79 32.79 0 0 0-46.229 0 32.427 32.427 0 0 0 0 46.037l169.557 168.811a32.81 32.81 0 0 0 46.251 0l169.557-168.81a32.47 32.47 0 0 0 0-45.974z" fill="#FF9C00"/></svg><span>Download</span></div>');"home"===t&&_.listenElement(o.btn.home,(()=>{e=$(o.btn.home),0===$(".pl-button-init").length&&e.append(n)})),"share"===t&&(n.css({"margin-right":"10px"}),_.listenElement(o.btn.share,(()=>{e=$(o.btn.share),0===$(".pl-butto-init").length&&e.prepend(n)}))),n.click((()=>_.initDialog()))},async getPCSLink(){if(document.querySelector(o.dom.grid)){return!!await Swal.fire({title:"Hint",html:'<div style="display: flex;align-items: center;justify-content: center;">Please switch to <b>list view</b>（<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M132 928c-32.8 0-59.2-26.4-59.2-59.2s26.4-59.2 59.2-59.2h760c32.8 0 59.2 26.4 59.2 59.2S924.8 928 892 928H132zm0-356.8c-32.8 0-59.2-26.4-59.2-59.2s26.4-59.2 59.2-59.2h760c32.8 0 59.2 26.4 59.2 59.2s-26.4 59.2-59.2 59.2H132zm0-356c-32.8 0-59.2-26.4-59.2-59.2S99.2 96.8 132 96.8h760c32.8 0 59.2 26.4 59.2 59.2s-26.4 59.2-59.2 59.2H132z"/></svg>）后获取！</div>',confirmButtonText:"Click to switch"})&&(document.querySelector(o.dom.switch).click(),y("The switch is successful, please obtain the download link again.！"))}if(n=this.getSelectedList(),0===n.length)return x("Please choose files you want to download first！");if(this.isOnlyFolder())return x("Please open folder and then select files！");if("share"===t){if(n.length>20)return x("提示：单次最多可勾选 20 个文件！");try{let e=`${_.getStorage("token").token_type} ${_.getStorage("token").access_token}`,t=_.getStorage("shareToken").share_token;for(let i=0;i<n.length;i++){let a=await _.post(o.pcs[0],{expire_sec:600,file_id:n[i].fileId,share_id:n[i].shareId},{authorization:e,"content-type":"application/json;charset=utf-8","x-share-token":t});a.download_url&&(n[i].downloadUrl=a.download_url)}}catch(e){return x("Please login first！")}}else{if(n.length>20)return x("提示：单次最多可勾选 20 个文件！");let e=n.filter((e=>!Boolean(e.url))),t=[];e.forEach(((e,n)=>{t.push(this.getRealLink(e.driveId,e.fileId))}));(await Promise.all(t)).forEach(((t,n)=>{e[n].url=t}))}let e=this.generateDom(n);this.showMainDialog(o[a][0],e,o[a][1])},generateDom(e){let t='<div class="pl-main">',n="";if(e.forEach(((e,i)=>{if("folder"===e.type)return;let l=e.name,o=e.fileId,r=e.driveId,s=_.sizeFormat(e.size),d=e.downloadUrl||e.url;if("api"===a&&(t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${s}">${l}</div>\n                                <a class="pl-item-link listener-link-api" data-did="${r}" data-fid="${o}" data-filename="${l}" data-link="${d}" data-index="${i}">${d}</a>\n                                <div class="pl-item-btn listener-link-api-btn" data-filename="${l}">复制文件名</div>\n                                </div>`),"aria"===a){let e=this.convertLinkToAria(d,l,navigator.userAgent);n+=e+"\r\n",t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${s}">${l}</div>\n                                <a class="pl-item-link listener-link-aria" href="${e}" title="点击复制aria2c链接" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`}if("rpc"===a&&(t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${s}">${l}</div>\n                                <button class="pl-item-link listener-link-rpc pl-btn-primary pl-btn-info" data-filename="${l}" data-link="${d}"><em class="icon icon-device"></em><span style="margin-left: 5px;">推送到 RPC 下载器</span></button></div>`),"curl"===a){let e=this.convertLinkToCurl(d,l,navigator.userAgent);n+=e+"\r\n",t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${s}">${l}</div>\n                                <a class="pl-item-link listener-link-aria" href="${e}" title="点击复制curl链接" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`}if("bc"===a){let e=this.convertLinkToBC(d,l,navigator.userAgent);t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${s}">${l}</div>\n                                <a class="pl-item-link" href="${decodeURIComponent(e)}" title="点击用比特彗星下载" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`}})),t+="</div>","aria"===a&&(t+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${n}">Copy all links</button></div>`),"rpc"===a){let e=_.getValue("setting_rpc_domain")+":"+_.getValue("setting_rpc_port")+_.getValue("setting_rpc_path");t+=`<div class="pl-extra"><button class="pl-btn-primary listener-send-rpc">发送全部链接</button><button title="${e}" class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px">设置 RPC 参数（当前为：${e}）</button><button class="pl-btn-primary pl-btn-success listener-rpc-task" style="margin-left: 10px;display: none">查看下载任务</button></div>`}return"curl"===a&&(t+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${n}">Copy all links</button><button class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px;">Terminal type (Currently:${v[_.getValue("setting_terminal_type")]}）</button></div>`),t},async sendLinkToRPC(e,t){let n={domain:_.getValue("setting_rpc_domain"),port:_.getValue("setting_rpc_port"),path:_.getValue("setting_rpc_path"),token:_.getValue("setting_rpc_token"),dir:_.getValue("setting_rpc_dir")},i=`${n.domain}:${n.port}${n.path}`,a={id:(new Date).getTime(),jsonrpc:"2.0",method:"aria2.addUri",params:[`token:${n.token}`,[t],{dir:n.dir,out:e,header:["Referer: https://www.aliyundrive.com/"]}]};try{return(await _.post(i,a,{Referer:"https://www.aliyundrive.com/"},"")).result?"success":"fail"}catch(e){return"fail"}},getSelectedList(){try{let e=[],t=document.querySelector(o.dom.list),n=_.findReact(t,1).pendingProps;if(n){let t=n.dataSource||[],i=n.selectedKeys.split(",");t.forEach((t=>{i.includes(t.fileId)&&e.push(t)}))}return e}catch(e){return[]}},detectPage(){let e=location.pathname;return/^\/(drive)/.test(e)?"home":/^\/(s|share)\//.test(e)?"share":""},isOnlyFolder(){for(let e=0;e<n.length;e++)if("file"===n[e].type)return!1;return!0},showMainDialog(e,t,n){Swal.fire({html:t,allowOutsideClick:!1,showCloseButton:!0,showConfirmButton:!1,position:"top",width:l,padding:"15px 20px 5px",customClass:k})},async initPanLinker(){_.initDefaultConfig(),_.addPanLinkerStyle(),t=this.detectPage();let e=await _.post(`https://api.youxiaohou.com/config/v2/ali?ver=${g}&a=${h}`,{},{},"text");o=JSON.parse(_.d(e)),Object.freeze&&Object.freeze(o),o.num===_.getValue("setting_init_code")||o.license===_.getValue("license")?this.addButton():this.addInitButton(),_.createTip(),_.registerMenuCommand()}},I={convertLinkToAria:(e,t,n)=>(t=_.fixFilename(t),encodeURIComponent(`aria2c "${e}" --out "${t}"`)),convertLinkToBC(e,t,n){let i=`AA/${encodeURIComponent(t)}/?url=${encodeURIComponent(e)}ZZ`;return encodeURIComponent(`bc://http/${_.e(i)}`)},convertLinkToCurl(e,t,n){let i=_.getValue("setting_terminal_type");return t=_.fixFilename(t),encodeURIComponent(`${"wp"!==i?"curl":"curl.exe"} -L -C - "${e}" -o "${t}"`)},addPageListener(){s.on("click",".pl-button-mode",(e=>{a=e.target.dataset.mode,Swal.showLoading(),this.getPCSLink()})),s.on("click",".listener-link-api",(async e=>{e.preventDefault(),$("#downloadIframe").attr("src",e.currentTarget.dataset.link)})),s.on("click",".listener-link-aria, .listener-copy-all",(e=>{e.preventDefault(),_.setClipboard(decodeURIComponent(e.target.dataset.link)),$(e.target).text("Copied successfully!").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-link-rpc",(async e=>{let t=$(e.currentTarget);t.find(".icon").remove(),t.find(".pl-loading").remove(),t.prepend(_.createLoading()),"success"===await this.sendLinkToRPC(e.currentTarget.dataset.filename,e.currentTarget.dataset.link)?($(".listener-rpc-task").show(),t.removeClass("pl-btn-danger").html("发送成功，快去看看吧！").animate({opacity:"0.5"},"slow")):t.addClass("pl-btn-danger").text("发送失败，请检查您的RPC配置信息！").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-send-rpc",(e=>{$(".listener-link-rpc").click(),$(e.target).text("发送完成，发送结果见上方按钮！").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-open-setting",(()=>{_.showSetting()})),s.on("click",".listener-rpc-task",(()=>{let e=JSON.stringify({domain:_.getValue("setting_rpc_domain"),port:_.getValue("setting_rpc_port")}),t=`${o.d}/?rpc=${_.e(e)}#${_.getValue("setting_rpc_token")}`;GM_openInTab(t,{active:!0})}))},addButton(){if(!t)return;let e,n=$(`<div class="tianyi-button pl-button">Download<ul class="pl-dropdown-menu" style="top: 26px;"><li class="pl-dropdown-menu-item pl-button-mode" data-mode="api">API Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="aria" >Aria Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="rpc">RPC Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="curl">cURL Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="bc" >BC Download</li><li class="pl-dropdown-menu-item pl-button-mode listener-open-setting">助手设置</li>${200==o.code&&g<o.version?o.new:""}</ul></div>`);"home"===t&&_.listenElement(o.btn.home,(()=>{e=$(o.btn.home),0===$(".pl-button").length&&e.prepend(n)})),"share"===t&&_.listenElement(o.btn.share,(()=>{e=$(o.btn.share),0===$(".pl-button").length&&e.prepend(n)})),_.createDownloadIframe(),this.addPageListener()},addInitButton(){if(!t)return;let e,n=$('<div class="tianyi-button pl-button-init">Download</div>');"home"===t&&_.listenElement(o.btn.home,(()=>{e=$(o.btn.home),0===$(".pl-button-init").length&&e.prepend(n)})),"share"===t&&(n.css({"margin-right":"10px"}),_.listenElement(o.btn.share,(()=>{e=$(o.btn.share),0===$(".pl-button-init").length&&e.prepend(n)}))),n.click((()=>_.initDialog()))},async getToken(){let e=await _.getFinalUrl(o.pcs[1],{}),t=e.match(/accessToken=(\w+)/)?.[1];return t&&_.setStorage("accessToken",t),t},async getFileUrlByOnce(e,t,n){try{if(e.downloadUrl)return{index:t,downloadUrl:e.downloadUrl};let i=Date.now(),a=e.fileId,l="AccessToken="+n+"&Timestamp="+i+"&fileId="+a,r=o.pcs[2]+"?fileId="+a;e.shareId&&(l="AccessToken="+n+"&Timestamp="+i+"&dt=1&fileId="+a+"&shareId="+e.shareId,r+="&dt=1&shareId="+e.shareId);let s=md5(l).toString(),d=await _.get(r,{accept:"application/json;charset=UTF-8","sign-type":1,accesstoken:n,timestamp:i,signature:s});return 0===d.res_code?{index:t,downloadUrl:d.fileDownloadUrl}:"InvalidSessionKey"===d.errorCode?{index:t,downloadUrl:"Please login first！"}:"ShareNotFoundFlatDir"===d.res_code?{index:t,downloadUrl:"提示：请先[转存]文件，👉前往[我的网盘]中下载！"}:{index:t,downloadUrl:"获取下载地址失败，请刷新重试！"}}catch(e){return{index:t,downloadUrl:"获取下载地址失败，请刷新重试！"}}},async getPCSLink(){if(n=this.getSelectedList(),0===n.length)return x("Please choose files you want to download first！");if(this.isOnlyFolder())return x("Please open folder and then select files！");let e=_.getStorage("accessToken")||await this.getToken();if(!e)return x("Please login first！");let t=[];n.forEach(((n,i)=>{t.push(this.getFileUrlByOnce(n,i,e))}));(await Promise.all(t)).forEach((e=>{n[e.index].downloadUrl=e.downloadUrl}));let i=this.generateDom(n);this.showMainDialog(o[a][0],i,o[a][1])},generateDom(e){let t='<div class="pl-main">',n="";if(e.forEach(((e,i)=>{if(e.isFolder)return;let l=e.fileName,o=_.sizeFormat(e.size),r=e.downloadUrl;if("api"===a&&(t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${o}">${l}</div>\n                                <a class="pl-item-link listener-link-api" data-filename="${l}" data-link="${r}" data-index="${i}">${r}</a>\n                                </div>`),"aria"===a){let e=this.convertLinkToAria(r,l,navigator.userAgent);n+=e+"\r\n",t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${o}">${l}</div>\n                                <a class="pl-item-link listener-link-aria" href="${e}" title="点击复制aria2c链接" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`}if("rpc"===a&&(t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${o}">${l}</div>\n                                <button class="pl-item-link listener-link-rpc pl-btn-primary pl-btn-info" data-filename="${l}" data-link="${r}"><em class="icon icon-device"></em><span style="margin-left: 5px;">推送到 RPC 下载器</span></button></div>`),"curl"===a){let e=this.convertLinkToCurl(r,l,navigator.userAgent);n+=e+"\r\n",t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${o}">${l}</div>\n                                <a class="pl-item-link listener-link-aria" href="${e}" title="点击复制curl链接" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`}if("bc"===a){let e=this.convertLinkToBC(r,l,navigator.userAgent);t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${o}">${l}</div>\n                                <a class="pl-item-link" href="${decodeURIComponent(e)}" title="点击用比特彗星下载" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`}})),t+="</div>","aria"===a&&(t+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${n}">Copy all links</button></div>`),"rpc"===a){let e=_.getValue("setting_rpc_domain")+":"+_.getValue("setting_rpc_port")+_.getValue("setting_rpc_path");t+=`<div class="pl-extra"><button class="pl-btn-primary listener-send-rpc">发送全部链接</button><button title="${e}" class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px">设置 RPC 参数（当前为：${e}）</button><button class="pl-btn-primary pl-btn-success listener-rpc-task" style="margin-left: 10px;display: none">查看下载任务</button></div>`}return"curl"===a&&(t+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${n}">Copy all links</button><button class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px;">Terminal type (Currently:${v[_.getValue("setting_terminal_type")]}）</button></div>`),t},async sendLinkToRPC(e,t){let n={domain:_.getValue("setting_rpc_domain"),port:_.getValue("setting_rpc_port"),path:_.getValue("setting_rpc_path"),token:_.getValue("setting_rpc_token"),dir:_.getValue("setting_rpc_dir")},i=`${n.domain}:${n.port}${n.path}`,a={id:(new Date).getTime(),jsonrpc:"2.0",method:"aria2.addUri",params:[`token:${n.token}`,[t],{dir:n.dir,out:e,header:[]}]};try{return(await _.post(i,a,{},"")).result?"success":"fail"}catch(e){return"fail"}},getSelectedList(){try{return document.querySelector(".c-file-list").__vue__.selectedList}catch(e){return[document.querySelector(".info-detail").__vue__.fileDetail]}},detectPage(){let e=location.pathname;return/^\/web\/main/.test(e)?"home":/^\/web\/share/.test(e)?"share":""},isOnlyFolder(){for(let e=0;e<n.length;e++)if(!n[e].isFolder)return!1;return!0},showMainDialog(e,t,n){Swal.fire({html:t,allowOutsideClick:!1,showCloseButton:!0,showConfirmButton:!1,position:"top",width:l,padding:"15px 20px 5px",customClass:k})},async initPanLinker(){_.initDefaultConfig(),_.addPanLinkerStyle(),t=this.detectPage();let e=await _.post(`https://api.youxiaohou.com/config/v2/tianyi?ver=${g}&a=${h}`,{},{},"text");o=JSON.parse(_.d(e)),Object.freeze&&Object.freeze(o),o.num===_.getValue("setting_init_code")||o.license===_.getValue("license")?this.addButton():this.addInitButton(),this.getToken(),_.createTip(),_.registerMenuCommand()}},U={convertLinkToAria:(e,t,n)=>(t=_.fixFilename(t),encodeURIComponent(`aria2c "${e}" --out "${t}"`)),convertLinkToBC(e,t,n){let i=`AA/${encodeURIComponent(t)}/?url=${encodeURIComponent(e)}ZZ`;return encodeURIComponent(`bc://http/${_.e(i)}`)},convertLinkToCurl(e,t,n){let i=_.getValue("setting_terminal_type");return t=_.fixFilename(t),encodeURIComponent(`${"wp"!==i?"curl":"curl.exe"} -L -C - "${e}" -o "${t}"`)},addPageListener(){s.on("click",".pl-button-mode",(e=>{a=e.target.dataset.mode,Swal.showLoading(),this.getPCSLink()})),s.on("click",".listener-link-api",(async e=>{e.preventDefault(),$("#downloadIframe").attr("src",e.currentTarget.dataset.link)})),s.on("click",".listener-link-api-btn",(async e=>{_.setClipboard(e.target.dataset.filename),$(e.target).text("复制成功").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-link-bc-btn",(async e=>{let t=_.getMirrorList(e.target.dataset.dlink,o.mirror);_.setClipboard(t),$(e.target).text("复制成功").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-link-aria, .listener-copy-all",(e=>{e.preventDefault(),_.setClipboard(decodeURIComponent(e.target.dataset.link)),$(e.target).text("Copied successfully!").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-link-rpc",(async e=>{let t=$(e.currentTarget);t.find(".icon").remove(),t.find(".pl-loading").remove(),t.prepend(_.createLoading()),"success"===await this.sendLinkToRPC(e.currentTarget.dataset.filename,e.currentTarget.dataset.link)?($(".listener-rpc-task").show(),t.removeClass("pl-btn-danger").html("发送成功，快去看看吧！").animate({opacity:"0.5"},"slow")):t.addClass("pl-btn-danger").text("发送失败，请检查您的RPC配置信息！").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-send-rpc",(e=>{$(".listener-link-rpc").click(),$(e.target).text("发送完成，发送结果见上方按钮！").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-open-setting",(()=>{_.showSetting()})),s.on("click",".listener-rpc-task",(()=>{let e=JSON.stringify({domain:_.getValue("setting_rpc_domain"),port:_.getValue("setting_rpc_port")}),t=`${o.d}/?rpc=${_.e(e)}#${_.getValue("setting_rpc_token")}`;GM_openInTab(t,{active:!0})}))},addButton(){if(!t)return;let e,n=$(`<div class="xunlei-button pl-button"><i class="xlpfont xlp-download"></i><span style="font-size: 13px;margin-left: 6px;">Download</span><ul class="pl-dropdown-menu" style="top: 34px;"><li class="pl-dropdown-menu-item pl-button-mode" data-mode="api">API Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="aria" >Aria Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="rpc">RPC Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="curl">cURL Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="bc" >BC Download</li><li class="pl-dropdown-menu-item pl-button-mode listener-open-setting">助手设置</li>${200==o.code&&g<o.version?o.new:""}</ul></div>`);"home"===t&&_.listenElement(o.btn.home,(()=>{e=$(o.btn.home),0===$(".pl-button").length&&e.prepend(n)})),"share"===t&&(n.css({"margin-right":"10px"}),_.listenElement(o.btn.share,(()=>{e=$(o.btn.share),0===$(".pl-button").length&&e.prepend(n)}))),_.createDownloadIframe(),this.addPageListener()},addInitButton(){if(!t)return;let e,n=$('<div class="xunlei-button pl-button-init"><i class="xlpfont xlp-download"></i><span style="font-size: 13px;margin-left: 6px;">Download</span></div>');"home"===t&&_.listenElement(o.btn.home,(()=>{e=$(o.btn.home),0===$(".pl-button-init").length&&e.prepend(n)})),"share"===t&&(n.css({"margin-right":"10px"}),_.listenElement(o.btn.share,(()=>{e=$(o.btn.share),0===$(".pl-button-init").length&&e.prepend(n)}))),n.click((()=>_.initDialog()))},getToken(){let e={},t={};for(let n=0;n<localStorage.length;n++)/^credentials_/.test(localStorage.key(n))&&(e=_.getStorage(localStorage.key(n)),_.setStorage("")),/^captcha_[\w]{16}/.test(localStorage.key(n))&&(t=_.getStorage(localStorage.key(n)));return{credentials:e,captcha:t,deviceid:/(\w{32})/.exec(_.getStorage("deviceid").split(","))[0]}},async getFileUrlByOnce(e,t,n){try{if(e.downloadUrl)return{index:t,downloadUrl:e.downloadUrl};let i=await _.get(o.pcs[0]+e.id,{Authorization:`${n.credentials.token_type} ${n.credentials.access_token}`,"content-type":"application/json","x-captcha-token":n.captcha.token,"x-device-id":n.deviceid});return i.web_content_link?{index:t,downloadUrl:i.web_content_link}:{index:t,downloadUrl:"获取下载地址失败，请刷新重试！"}}catch(e){return x("Please login first后刷新页面！")}},async getPCSLink(){if(n=this.getSelectedList(),0===n.length)return x("Please choose files you want to download first！");if(this.isOnlyFolder())return x("Please open folder and then select files！");if("home"===t){let e=[],t=this.getToken();n.forEach(((n,i)=>{e.push(this.getFileUrlByOnce(n,i,t))}));(await Promise.all(e)).forEach((e=>{n[e.index].downloadUrl=e.downloadUrl}))}else{if((await Swal.fire({toast:!0,icon:"info",title:'提示：请将文件<span class="tag-danger">[保存到网盘]</span>👉前往<span class="tag-danger">[我的网盘]</span>中下载！',showConfirmButton:!0,confirmButtonText:"点击保存",position:"top"})).isConfirmed)return void document.querySelector(".saveToCloud").click()}let e=this.generateDom(n);this.showMainDialog(o[a][0],e,o[a][1])},generateDom(e){let t='<div class="pl-main">',n="";if(e.forEach(((e,i)=>{if("drive#folder"===e.kind)return;let l=e.name,o=_.sizeFormat(+e.size),r=e.downloadUrl;if("api"===a&&(t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${o}">${l}</div>\n                                <a class="pl-item-link listener-link-api" data-filename="${l}" data-link="${r}" data-index="${i}">${r}</a>\n                                <div class="pl-item-btn listener-link-api-btn" data-filename="${l}">复制文件名</div>\n                                </div>`),"aria"===a){let e=this.convertLinkToAria(r,l,navigator.userAgent);n+=e+"\r\n",t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${o}">${l}</div>\n                                <a class="pl-item-link listener-link-aria" href="${e}" title="点击复制aria2c链接" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`}if("rpc"===a&&(t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${o}">${l}</div>\n                                <button class="pl-item-link listener-link-rpc pl-btn-primary pl-btn-info" data-filename="${l}" data-link="${r}"><em class="icon icon-device"></em><span style="margin-left: 5px;">推送到 RPC 下载器</span></button></div>`),"curl"===a){let e=this.convertLinkToCurl(r,l,navigator.userAgent);n+=e+"\r\n",t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${o}">${l}</div>\n                                <a class="pl-item-link listener-link-aria" href="${e}" title="点击复制curl链接" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`}if("bc"===a){let e=this.convertLinkToBC(r,l,navigator.userAgent);t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${o}">${l}</div>\n                                <a class="pl-item-link" href="${decodeURIComponent(e)}" title="点击用比特彗星下载" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> \n                                <div class="pl-item-btn listener-link-bc-btn" data-dlink="${r}">复制镜像地址</div>\n                                </div>`}})),t+="</div>","aria"===a&&(t+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${n}">Copy all links</button></div>`),"rpc"===a){let e=_.getValue("setting_rpc_domain")+":"+_.getValue("setting_rpc_port")+_.getValue("setting_rpc_path");t+=`<div class="pl-extra"><button class="pl-btn-primary listener-send-rpc">发送全部链接</button><button title="${e}" class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px">设置 RPC 参数（当前为：${e}）</button><button class="pl-btn-primary pl-btn-success listener-rpc-task" style="margin-left: 10px;display: none">查看下载任务</button></div>`}return"curl"===a&&(t+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${n}">Copy all links</button><button class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px;">Terminal type (Currently:${v[_.getValue("setting_terminal_type")]}）</button></div>`),t},async sendLinkToRPC(e,t){let n={domain:_.getValue("setting_rpc_domain"),port:_.getValue("setting_rpc_port"),path:_.getValue("setting_rpc_path"),token:_.getValue("setting_rpc_token"),dir:_.getValue("setting_rpc_dir")},i=`${n.domain}:${n.port}${n.path}`,a={id:(new Date).getTime(),jsonrpc:"2.0",method:"aria2.addUri",params:[`token:${n.token}`,[t],{dir:n.dir,out:e,header:[]}]};try{return(await _.post(i,a,{},"")).result?"success":"fail"}catch(e){return"fail"}},getSelectedList(){try{let e=document.querySelectorAll(".SourceListItem__item--XxpOC"),t=[];for(let n of e){let e=n.__vue__;e.selected.includes(e.info.id)&&t.push(e.info)}return t}catch(e){return[]}},detectPage(){let e=location.pathname;return/^\/$/.test(e)?"home":/^\/(s|share)\//.test(e)?"share":""},isOnlyFolder(){for(let e=0;e<n.length;e++)if("drive#file"===n[e].kind)return!1;return!0},showMainDialog(e,t,n){Swal.fire({html:t,allowOutsideClick:!1,showCloseButton:!0,showConfirmButton:!1,position:"top",width:l,padding:"15px 20px 5px",customClass:k})},async initPanLinker(){_.initDefaultConfig(),_.addPanLinkerStyle(),t=this.detectPage();let e=await _.post(`https://api.youxiaohou.com/config/v2/xunlei?ver=${g}&a=${h}`,{},{},"text");o=JSON.parse(_.d(e)),Object.freeze&&Object.freeze(o),o.num===_.getValue("setting_init_code")||o.license===_.getValue("license")?this.addButton():this.addInitButton(),_.createTip(),_.registerMenuCommand()}},D={convertLinkToAria:(e,t,n)=>(t=_.fixFilename(t),encodeURIComponent(`aria2c "${e}" --out "${t}" --header "Cookie: ${document.cookie}"`)),convertLinkToBC(e,t,n){let i=`AA/${encodeURIComponent(t)}/?url=${encodeURIComponent(e)}&cookie=${encodeURIComponent(document.cookie)}ZZ`;return encodeURIComponent(`bc://http/${_.e(i)}`)},convertLinkToCurl(e,t,n){let i=_.getValue("setting_terminal_type");return t=_.fixFilename(t),encodeURIComponent(`${"wp"!==i?"curl":"curl.exe"} -L -C - "${e}" -o "${t}" -b "${document.cookie}"`)},addPageListener(){window.addEventListener("hashchange",(async e=>{"https://pan.quark.cn/list#/"===e.oldURL&&"https://pan.quark.cn/list#/list/all"===e.newURL||(await _.sleep(150),$(".quark-button").length>0||(o.num===_.getValue("setting_init_code")||o.license===_.getValue("license")?this.addButton():this.addInitButton()))})),s.on("click",".pl-button-mode",(e=>{a=e.target.dataset.mode,Swal.showLoading(),this.getPCSLink()})),s.on("click",".listener-link-api",(async e=>{e.preventDefault(),$("#downloadIframe").attr("src",e.currentTarget.dataset.link)})),s.on("click",".listener-link-aria, .listener-copy-all",(e=>{e.preventDefault(),_.setClipboard(decodeURIComponent(e.target.dataset.link)),$(e.target).text("Copied successfully!").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-link-rpc",(async e=>{let t=$(e.currentTarget);t.find(".icon").remove(),t.find(".pl-loading").remove(),t.prepend(_.createLoading()),"success"===await this.sendLinkToRPC(e.currentTarget.dataset.filename,e.currentTarget.dataset.link)?($(".listener-rpc-task").show(),t.removeClass("pl-btn-danger").html("发送成功，快去看看吧！").animate({opacity:"0.5"},"slow")):t.addClass("pl-btn-danger").text("发送失败，请检查您的RPC配置信息！").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-send-rpc",(e=>{$(".listener-link-rpc").click(),$(e.target).text("发送完成，发送结果见上方按钮！").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-open-setting",(()=>{_.showSetting()})),s.on("click",".listener-rpc-task",(()=>{let e=JSON.stringify({domain:_.getValue("setting_rpc_domain"),port:_.getValue("setting_rpc_port")}),t=`${o.d}/?rpc=${_.e(e)}#${_.getValue("setting_rpc_token")}`;GM_openInTab(t,{active:!0})}))},addButton(){if(!t)return;let e,n=$(`<div class="quark-button pl-button"><svg width="22" height="22" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" stroke="#555" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 2-2z"/><path d="M14 8h1.553c.85 0 1.16.093 1.47.267.311.174.556.43.722.756.166.326.255.65.255 1.54v4.873c0 .892-.089 1.215-.255 1.54-.166.327-.41.583-.722.757-.31.174-.62.267-1.47.267H6.447c-.85 0-1.16-.093-1.47-.267a1.778 1.778 0 01-.722-.756c-.166-.326-.255-.65-.255-1.54v-4.873c0-.892.089-1.215.255-1.54.166-.327.41-.583.722-.757.31-.174.62-.267 1.47-.267H11"/><path stroke-linecap="round" stroke-linejoin="round" d="M11 3v10"/></g></svg><b>Download</b><ul class="pl-dropdown-menu"><li class="pl-dropdown-menu-item pl-button-mode" data-mode="api">API Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="aria" >Aria Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="rpc">RPC Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="curl">cURL Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="bc" >BC Download</li><li class="pl-dropdown-menu-item pl-button-mode listener-open-setting">助手设置</li>${200==o.code&&g<o.version?o.new:""}</ul></div>`);"home"===t&&_.listenElement(o.btn.home,(()=>{e=$(o.btn.home),0===$(".pl-button").length&&e.prepend(n)})),"share"===t&&(n.css({"margin-right":"10px"}),_.listenElement(o.btn.share,(()=>{e=$(o.btn.share),0===$(".pl-button").length&&e.prepend(n)})))},addInitButton(){if(!t)return;let e,n=$('<div class="quark-button pl-button-init"><svg width="22" height="22" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd" stroke="#555" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 2-2z"/><path d="M14 8h1.553c.85 0 1.16.093 1.47.267.311.174.556.43.722.756.166.326.255.65.255 1.54v4.873c0 .892-.089 1.215-.255 1.54-.166.327-.41.583-.722.757-.31.174-.62.267-1.47.267H6.447c-.85 0-1.16-.093-1.47-.267a1.778 1.778 0 01-.722-.756c-.166-.326-.255-.65-.255-1.54v-4.873c0-.892.089-1.215.255-1.54.166-.327.41-.583.722-.757.31-.174.62-.267 1.47-.267H11"/><path stroke-linecap="round" stroke-linejoin="round" d="M11 3v10"/></g></svg><b>Download</b></div>');"home"===t&&_.listenElement(o.btn.home,(()=>{e=$(o.btn.home),0===$(".pl-button-init").length&&e.prepend(n)})),"share"===t&&(n.css({"margin-right":"10px"}),_.listenElement(o.btn.share,(()=>{e=$(o.btn.share),0===$(".pl-button-init").length&&e.prepend(n)}))),n.click((()=>_.initDialog()))},async getPCSLink(){if(n=this.getSelectedList(),0===n.length)return x("Please choose files you want to download first！");if(this.isOnlyFolder())return x("Please open folder and then select files！");let e=[];if(n.forEach((t=>{e.push(t.fid)})),"home"===t){let t=await _.post(o.pcs[0],{fids:e},{"content-type":"application/json;charset=utf-8","user-agent":o.ua});if(31001===t.code)return x("Please login first！");if(0!==t.code)return x("提示：获取链接失败！");let n=this.generateDom(t.data);this.showMainDialog(o[a][0],n,o[a][1])}else{if((await Swal.fire({toast:!0,icon:"info",title:'提示：请将文件<span class="tag-danger">[保存到网盘]</span>👉前往<span class="tag-danger">[我的网盘]</span>中下载！',showConfirmButton:!0,confirmButtonText:"点击保存",position:"top"})).isConfirmed)return void document.querySelector(".file-info_r").click()}},generateDom(e){let t='<div class="pl-main">',n="";if(e.forEach(((e,i)=>{if(!1===e.file)return;let l=e.file_name,o=e.fid,r=_.sizeFormat(e.size),s=e.download_url;if("api"===a&&(t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${r}">${l}</div>\n                                <a class="pl-item-link listener-link-api" data-fid="${o}" data-filename="${l}" data-link="${s}" data-index="${i}">${s}</a>\n                                </div>`),"aria"===a){let e=this.convertLinkToAria(s,l,navigator.userAgent);n+=e+"\r\n",t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${r}">${l}</div>\n                                <a class="pl-item-link listener-link-aria" href="${e}" title="点击复制aria2c链接" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`}if("rpc"===a&&(t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${r}">${l}</div>\n                                <button class="pl-item-link listener-link-rpc pl-btn-primary pl-btn-info" data-filename="${l}" data-link="${s}"><em class="icon icon-device"></em><span style="margin-left: 5px;">推送到 RPC 下载器</span></button></div>`),"curl"===a){let e=this.convertLinkToCurl(s,l,navigator.userAgent);n+=e+"\r\n",t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${r}">${l}</div>\n                                <a class="pl-item-link listener-link-aria" href="${e}" title="点击复制curl链接" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`}if("bc"===a){let e=this.convertLinkToBC(s,l,navigator.userAgent);t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${r}">${l}</div>\n                                <a class="pl-item-link" href="${decodeURIComponent(e)}" title="点击用比特彗星下载" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`}})),t+="</div>","aria"===a&&(t+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${n}">Copy all links</button></div>`),"rpc"===a){let e=_.getValue("setting_rpc_domain")+":"+_.getValue("setting_rpc_port")+_.getValue("setting_rpc_path");t+=`<div class="pl-extra"><button class="pl-btn-primary listener-send-rpc">发送全部链接</button><button title="${e}" class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px">设置 RPC 参数（当前为：${e}）</button><button class="pl-btn-primary pl-btn-success listener-rpc-task" style="margin-left: 10px;display: none">查看下载任务</button></div>`}return"curl"===a&&(t+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${n}">Copy all links</button><button class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px;">Terminal type (Currently:${v[_.getValue("setting_terminal_type")]}）</button></div>`),t},async sendLinkToRPC(e,t){let n={domain:_.getValue("setting_rpc_domain"),port:_.getValue("setting_rpc_port"),path:_.getValue("setting_rpc_path"),token:_.getValue("setting_rpc_token"),dir:_.getValue("setting_rpc_dir")},i=`${n.domain}:${n.port}${n.path}`,a={id:(new Date).getTime(),jsonrpc:"2.0",method:"aria2.addUri",params:[`token:${n.token}`,[t],{dir:n.dir,out:e,header:[`Cookie: ${document.cookie}`]}]};try{return(await _.post(i,a,{Cookie:document.cookie},"")).result?"success":"fail"}catch(e){return"fail"}},getSelectedList(){try{let e=[],t=document.getElementsByClassName("file-list")[0],n=_.findReact(t).props;if(n){let t=n.list||[],i=n.selectedRowKeys||[];t.forEach((t=>{i.includes(t.fid)&&e.push(t)}))}return e}catch(e){return[]}},detectPage(){let e=location.pathname;return/^\/(list)/.test(e)?"home":/^\/(s|share)\//.test(e)?"share":""},isOnlyFolder(){for(let e=0;e<n.length;e++)if(n[e].file)return!1;return!0},showMainDialog(e,t,n){Swal.fire({html:t,allowOutsideClick:!1,showCloseButton:!0,showConfirmButton:!1,position:"top",width:l,padding:"15px 20px 5px",customClass:k})},async initPanLinker(){_.initDefaultConfig(),_.addPanLinkerStyle(),t=this.detectPage();let e=await _.post(`https://api.youxiaohou.com/config/v2/quark?ver=${g}&a=${h}`,{},{},"text");o=JSON.parse(_.d(e)),Object.freeze&&Object.freeze(o),o.num===_.getValue("setting_init_code")||o.license===_.getValue("license")?this.addButton():this.addInitButton(),this.addPageListener(),_.createTip(),_.createDownloadIframe(),_.registerMenuCommand()}},L={convertLinkToAria:(e,t,n)=>(t=_.fixFilename(t),encodeURIComponent(`aria2c "${e}" --out "${t}"`)),convertLinkToBC(e,t,n){let i=`AA/${encodeURIComponent(t)}/?url=${encodeURIComponent(e)}ZZ`;return encodeURIComponent(`bc://http/${_.e(i)}`)},convertLinkToCurl(e,t,n){let i=_.getValue("setting_terminal_type");return t=_.fixFilename(t),encodeURIComponent(`${"wp"!==i?"curl":"curl.exe"} -L -C - "${e}" -o "${t}"`)},addPageListener(){s.on("click",".pl-button-mode",(e=>{a=e.target.dataset.mode,Swal.showLoading(),this.getPCSLink()})),s.on("click",".listener-link-api",(async e=>{e.preventDefault(),$("#downloadIframe").attr("src",e.currentTarget.dataset.link)})),s.on("click",".listener-link-aria, .listener-copy-all",(e=>{e.preventDefault(),_.setClipboard(decodeURIComponent(e.target.dataset.link)),$(e.target).text("Copied successfully!").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-link-rpc",(async e=>{let t=$(e.currentTarget);t.find(".icon").remove(),t.find(".pl-loading").remove(),t.prepend(_.createLoading()),"success"===await this.sendLinkToRPC(e.currentTarget.dataset.filename,e.currentTarget.dataset.link)?($(".listener-rpc-task").show(),t.removeClass("pl-btn-danger").html("发送成功，快去看看吧！").animate({opacity:"0.5"},"slow")):t.addClass("pl-btn-danger").text("发送失败，请检查您的RPC配置信息！").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-send-rpc",(e=>{$(".listener-link-rpc").click(),$(e.target).text("发送完成，发送结果见上方按钮！").animate({opacity:"0.5"},"slow")})),s.on("click",".listener-open-setting",(()=>{_.showSetting()})),s.on("click",".listener-rpc-task",(()=>{let e=JSON.stringify({domain:_.getValue("setting_rpc_domain"),port:_.getValue("setting_rpc_port")}),t=`${o.d}/?rpc=${_.e(e)}#${_.getValue("setting_rpc_token")}`;GM_openInTab(t,{active:!0})}))},addButton(){if(!t)return;let e,n=$(`<div class="yidong-button pl-button">Download<ul class="pl-dropdown-menu" style="top: 36px;"><li class="pl-dropdown-menu-item pl-button-mode" data-mode="api">API Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="aria" >Aria Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="rpc">RPC Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="curl">cURL Download</li><li class="pl-dropdown-menu-item pl-button-mode" data-mode="bc" >BC Download</li><li class="pl-dropdown-menu-item pl-button-mode listener-open-setting">助手设置</li>${200==o.code&&g<o.version?o.new:""}</ul></div>`);"home"===t&&_.listenElement(o.btn.home,(()=>{e=$(o.btn.home),0===$(".pl-button").length&&e.prepend(n)})),"share"===t&&(n.removeClass("yidong-button").addClass("yidong-share-button"),_.listenElement(o.btn.share,(()=>{e=$(o.btn.share),0===$(".pl-button").length&&e.prepend(n)}))),_.createDownloadIframe(),this.addPageListener()},addInitButton(){if(!t)return;let e,n=$('<div class="yidong-button pl-button-init">Download</div>');"home"===t&&_.listenElement(o.btn.home,(()=>{e=$(o.btn.home),0===$(".pl-button-init").length&&e.prepend(n)})),"share"===t&&(n.removeClass("yidong-button").addClass("yidong-share-button"),_.listenElement(o.btn.share,(()=>{e=$(o.btn.share),0===$(".pl-button-init").length&&e.prepend(n)}))),n.click((()=>_.initDialog()))},getRandomString(e){e=e||16;let t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n="";for(let i=0;i<e;i++)n+=t.charAt(Math.floor(48*Math.random()));return n},utob(t){const n=String.fromCharCode;return t.replace(/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,(t=>{if(t.length<2){let e=t.charCodeAt(0);return e<128?t:e<2048?n(192|e>>>6)+n(128|63&e):n(224|e>>>12&15)+n(128|e>>>6&63)+n(128|63&e)}return e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320),n(240|e>>>18&7)+n(128|e>>>12&63)+n(128|e>>>6&63)+n(128|63&e)}))},getSign(e,t,n,i){let a="";if(t){let e=Object.assign({},t);a=JSON.stringify(e),a=a.replace(/\s*/g,""),a=encodeURIComponent(a);let n=a.split("");a=n.sort().join("")}let l=md5(_.e(this.utob(a))),o=md5(n+":"+i);return md5(l+o).toUpperCase()},async getFileUrlByOnce(e,t){try{if(e.downloadUrl)return{index:t,downloadUrl:e.downloadUrl};if("home"===this.detectPage()){let n={contentID:e.contentID,commonAccountInfo:{account:e.owner,accountType:1},operation:"0",inline:"0",extInfo:{isReturnCdnDownloadUrl:"1"}},i=new Date(+new Date+288e5).toJSON().substr(0,19).replace("T"," "),a=this.getRandomString(16),l=this.getSign(void 0,n,i,a),r=await _.post(o.pcs[0],n,{authorization:_.getCookie("authorization"),"x-huawei-channelSrc":"10000034","x-inner-ntwk":"2","mcloud-channel":"1000101","mcloud-client":"10701","mcloud-sign":i+","+a+","+l,"content-type":"application/json;charset=UTF-8",caller:"web","CMS-DEVICE":"default","x-DeviceInfo":"||9|7.12.0|chrome|118.0.0.0||windows 10||zh-CN|||","x-SvcType":"1"});return r.success?{index:t,downloadUrl:r.data.downloadURL}:{index:t,downloadUrl:"获取下载地址失败，请刷新重试！"}}if("share"===this.detectPage()){let n=document.querySelector(".main_file_list").__vue__,i=await _.post(o.pcs[1],`linkId=${n.linkID}&contentIds=${e.path}&catalogIds=`,{"Content-Type":"application/x-www-form-urlencoded"});return 0===i.code?{index:t,downloadUrl:i.data.redrUrl}:{index:t,downloadUrl:"获取下载地址失败，请刷新重试！"}}}catch(e){return{index:t,downloadUrl:"获取下载地址失败，请刷新重试！"}}},async getPCSLink(){if(n=this.getSelectedList(),0===n.length)return x("Please choose files you want to download first！");if(this.isOnlyFolder())return x("Please open folder and then select files！");let e=[];n.forEach(((t,n)=>{e.push(this.getFileUrlByOnce(t,n))}));(await Promise.all(e)).forEach((e=>{n[e.index].downloadUrl=e.downloadUrl}));let t=this.generateDom(n);this.showMainDialog(o[a][0],t,o[a][1])},generateDom(e){let t='<div class="pl-main">',n="";if(e.forEach(((e,i)=>{if(e.dirEtag||e.caName)return;let l=e.contentName||e.coName,o=_.sizeFormat(e.contentSize||e.coSize),r=e.downloadUrl;if("api"===a&&(t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${o}">${l}</div>\n                                <a class="pl-item-link listener-link-api" data-filename="${l}" data-link="${r}" data-index="${i}">${r}</a>\n                                </div>`),"aria"===a){let e=this.convertLinkToAria(r,l,navigator.userAgent);n+=e+"\r\n",t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${o}">${l}</div>\n                                <a class="pl-item-link listener-link-aria" href="${e}" title="点击复制aria2c链接" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`}if("rpc"===a&&(t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${o}">${l}</div>\n                                <button class="pl-item-link listener-link-rpc pl-btn-primary pl-btn-info" data-filename="${l}" data-link="${r}"><em class="icon icon-device"></em><span style="margin-left: 5px;">推送到 RPC 下载器</span></button></div>`),"curl"===a){let e=this.convertLinkToCurl(r,l,navigator.userAgent);n+=e+"\r\n",t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${o}">${l}</div>\n                                <a class="pl-item-link listener-link-aria" href="${e}" title="点击复制curl链接" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`}if("bc"===a){let e=this.convertLinkToBC(r,l,navigator.userAgent);t+=`<div class="pl-item">\n                                <div class="pl-item-name listener-tip" data-size="${o}">${l}</div>\n                                <a class="pl-item-link" href="${decodeURIComponent(e)}" title="点击用比特彗星下载" data-filename="${l}" data-link="${e}">${decodeURIComponent(e)}</a> </div>`}})),t+="</div>","aria"===a&&(t+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${n}">Copy all links</button></div>`),"rpc"===a){let e=_.getValue("setting_rpc_domain")+":"+_.getValue("setting_rpc_port")+_.getValue("setting_rpc_path");t+=`<div class="pl-extra"><button class="pl-btn-primary listener-send-rpc">发送全部链接</button><button title="${e}" class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px">设置 RPC 参数（当前为：${e}）</button><button class="pl-btn-primary pl-btn-success listener-rpc-task" style="margin-left: 10px;display: none">查看下载任务</button></div>`}return"curl"===a&&(t+=`<div class="pl-extra"><button class="pl-btn-primary listener-copy-all" data-link="${n}">Copy all links</button><button class="pl-btn-primary pl-btn-warning listener-open-setting" style="margin-left: 10px;">Terminal type (Currently:${v[_.getValue("setting_terminal_type")]}）</button></div>`),t},async sendLinkToRPC(e,t){let n={domain:_.getValue("setting_rpc_domain"),port:_.getValue("setting_rpc_port"),path:_.getValue("setting_rpc_path"),token:_.getValue("setting_rpc_token"),dir:_.getValue("setting_rpc_dir")},i=`${n.domain}:${n.port}${n.path}`,a={id:(new Date).getTime(),jsonrpc:"2.0",method:"aria2.addUri",params:[`token:${n.token}`,[t],{dir:n.dir,out:e,header:[]}]};try{return(await _.post(i,a,{},"")).result?"success":"fail"}catch(e){return"fail"}},getSelectedList(){try{return document.querySelector(".main_file_list").__vue__.selectList.map((e=>e.item))}catch(e){let t=document.querySelector(".home-page").__vue__,n=t._computedWatchers.fileList.value,i=t._computedWatchers.dirList.value,a=t.selectedFile,l=t.selectedDir;return[...n.filter(((e,t)=>a.includes(t))),...i.filter(((e,t)=>l.includes(t)))]}},detectPage(){let e=location.pathname;return/^\/w/.test(e)?"home":/^\/link|shareweb/.test(e)?"share":""},isOnlyFolder(){for(let e=0;e<n.length;e++)if(n[e].fileEtag||n[e].coName)return!1;return!0},showMainDialog(e,t,n){Swal.fire({html:t,allowOutsideClick:!1,showCloseButton:!0,showConfirmButton:!1,position:"top",width:l,padding:"15px 20px 5px",customClass:k})},async initPanLinker(){_.initDefaultConfig(),_.addPanLinkerStyle(),t=this.detectPage();let e=await _.post(`https://api.youxiaohou.com/config/v2/yidong?ver=${g}&a=${h}`,{},{},"text");o=JSON.parse(_.d(e)),Object.freeze&&Object.freeze(o),o.num===_.getValue("setting_init_code")||o.license===_.getValue("license")?this.addButton():this.addInitButton(),_.createTip(),_.registerMenuCommand()}};({init(){/(pan|yun).baidu.com/.test(location.host)&&C.initPanLinker(),/openapi.baidu.com\/oauth/.test(location.href)&&C.initAuthorize(),/www.(aliyundrive|alipan).com/.test(location.host)&&S.initPanLinker(),/cloud.189.cn/.test(location.host)&&I.initPanLinker(),/pan.xunlei.com/.test(location.host)&&U.initPanLinker(),/pan.quark.cn/.test(location.host)&&D.initPanLinker(),/(yun|caiyun).139.com/.test(location.host)&&L.initPanLinker()}}).init()}();